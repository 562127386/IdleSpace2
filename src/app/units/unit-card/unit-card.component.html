<nz-card
  style="width: 100%;"
  nzSize="small"
  [nzTitle]="cardTitleTemplate"
  [nzExtra]="extraTemplate"
  [nzActions]="actions"
>
  <p *ngIf="unit.description !== ''">
    {{ unit.description }}
  </p>

  <div *ngIf="unit.production.length > 0">
    <!-- <span nz-text><span>Operativity:</span></span>
    <span class="monospace">{{ unit.operativity | format }}</span
    >% -->
    <nz-slider
      [(ngModel)]="unit.operativity"
      [nzDisabled]="sliderDisabled"
      [nzStep]="0.1"
    ></nz-slider>

    <!-- Priority -->
    <div
      class="priority"
      fxLayout="row"
      fxLayoutGap="4px"
      *ngIf="ms.game.resourceManager.components.unlocked"
      fxLayoutAlign="center"
    >
      <span
        nz-popover
        nzPopoverTitle="Assembly Priority"
        [nzPopoverContent]="priorityTemplate"
        >Priority:
      </span>

      <ng-template #priorityTemplate>
        <p>
          Priorities for assembling new drones.<br />
          The first item is the normal priority,<br />the second is used when
          resources are ending.
        </p>
      </ng-template>

      <nz-input-number
        [(ngModel)]="unit.assemblyPriority"
        [nzSize]="'small'"
        [nzMin]="0"
        [nzMax]="1e3"
        [nzStep]="1"
      ></nz-input-number>
      <nz-input-number
        [(ngModel)]="unit.assemblyPriorityEnding"
        [nzSize]="'small'"
        [nzMin]="0"
        [nzMax]="1e3"
        [nzStep]="1"
      ></nz-input-number>
    </div>
  </div>

  <!-- Prices -->
  <div fxLayoutAlign="center" fxLayout="row">
    <span *ngFor="let pri of unit.buyPrice.prices; trackBy: getPriceId">
      <span nz-text [nzType]="pri.canBuy ? '' : 'danger'">
        <i
          nz-icon
          class="priceIcon"
          [nzType]="pri.spendable.icon"
          [ngClass]="pri?.spendable?.colorClass"
        ></i>
        <span *ngIf="!pri.spendable.icon">{{ pri.spendable.name }}</span>
        <span class="monospace">{{ pri.singleCost | format }}</span>
        <span
          class="comma"
          *ngIf="
            unit.buyPrice.prices.indexOf(pri) !==
            unit.buyPrice.prices.length - 1
          "
          >,</span
        >
      </span>
    </span>
  </div>
  <button
    nz-button
    nzType="link"
    class="mod-button"
    *ngIf="unit.modStack"
    (click)="goModPage()"
  >
    Mods used:
    <span class="monospace">
      {{ unit.modStack.used | format: true }} /
      {{ unit.maxMods | format: true }}</span
    >
  </button>
</nz-card>

<ng-template #extraTemplate>
  <span class="infoIcon" *ngIf="unit.production.length > 0">
    <span
      nz-popover
      [nzPopoverContent]="contentTemplate"
      [nzPopoverTrigger]="popoverTrigger"
      (click)="createModal(contentTemplate, tplFooter)"
    >
      <!-- [nzPopoverTitle]="titleTemplate" -->
      <i nz-icon nzType="info-circle" nzTheme="outline"></i>
    </span>
  </span>
</ng-template>
<ng-template #cardTitleTemplate>
  <strong>{{ unit.name }}</strong>
  <span class="monospace">
    {{ unit.quantity | format: true }}
    <!-- ({{ unit.manualBought | format }}) -->
    <span *ngIf="unit.limit.lt(Decimal.MAX_VALUE)">
      /
      {{ unit.limit | format: true }}
    </span>
  </span>
</ng-template>
<ng-template #titleTemplate>
  <i nz-icon nzType="table"></i> Production</ng-template
>

<!-- Production Table -->
<ng-template #contentTemplate>
  <app-prod-table [unit]="unit"></app-prod-table>
</ng-template>

<!-- Buttons -->
<ng-template #buyOne>
  <button (click)="buyOneAct()" nz-button nzType="link" nzSize="small">
    Buy
    <span class="monospace">1</span>
  </button>
</ng-template>
<ng-template #buyHalf>
  <button (click)="buyHalfAct()" nz-button nzType="link" nzSize="small">
    Buy
    <span class="monospace">{{ unit.buyPrice.halfBuy | format: true }}</span>
  </button>
</ng-template>
<ng-template #buyMax>
  <button (click)="buyMaxAct()" nz-button nzType="link" nzSize="small">
    Buy <span class="monospace">{{ unit.buyPrice.maxBuy | format: true }}</span>
  </button>
</ng-template>
<ng-template #buyNone>
  <button nz-button nzType="link" disabled="true" nzSize="small">
    Can't buy
  </button>
</ng-template>
<ng-template #tplFooter>
  <button nz-button nzType="primary" (click)="destroyTplModal()" nzSize="small">
    Ok
  </button>
</ng-template>
